function extractElementsForComparison(t){const e=(new DOMParser).parseFromString(t,"text/xml"),s=e.querySelector("parsererror");if(s)throw new Error("Invalid XML: "+s.textContent);return{places:Array.from(e.querySelectorAll("place")).map(t=>{const e=t.querySelector("name > text"),s=t.querySelector("name > graphics > offset"),l=t.querySelector("initialMarking > text"),r=t.querySelector("graphics > position"),a=t.querySelector("graphics > dimension");return{id:t.getAttribute("id"),name:e?.textContent||"",tokens:l?.textContent||"0",x:r?.getAttribute("x")||"0",y:r?.getAttribute("y")||"0",width:a?.getAttribute("x")||"0",height:a?.getAttribute("y")||"0",labelOffsetX:s?.getAttribute("x")||"0",labelOffsetY:s?.getAttribute("y")||"0"}}).sort((t,e)=>t.id.localeCompare(e.id)),transitions:Array.from(e.querySelectorAll("transition")).map(t=>{const e=t.querySelector("name > text"),s=t.querySelector("name > graphics > offset"),l=t.querySelector("graphics > position"),r=t.querySelector("graphics > dimension");return{id:t.getAttribute("id"),name:e?.textContent||"",isEmpty:!!t.querySelector('toolspecific[tool="petrinet.io"] property[key="transitionType"][value="empty"]'),x:l?.getAttribute("x")||"0",y:l?.getAttribute("y")||"0",width:r?.getAttribute("x")||"0",height:r?.getAttribute("y")||"0",labelOffsetX:s?.getAttribute("x")||"0",labelOffsetY:s?.getAttribute("y")||"0"}}).sort((t,e)=>t.id.localeCompare(e.id)),arcs:Array.from(e.querySelectorAll("arc")).map(t=>{const e=t.querySelector("inscription > text"),s=t.querySelector("inscription > graphics > offset"),l=Array.from(t.querySelectorAll("graphics > position")).map(t=>({x:t.getAttribute("x"),y:t.getAttribute("y")}));return{id:t.getAttribute("id"),source:t.getAttribute("source"),target:t.getAttribute("target"),inscription:e?.textContent||"",labelOffsetX:s?.getAttribute("x")||"0",labelOffsetY:s?.getAttribute("y")||"0",waypoints:l,waypointCount:l.length}}).sort((t,e)=>t.source!==e.source?t.source.localeCompare(e.source):t.target!==e.target?t.target.localeCompare(e.target):t.id.localeCompare(e.id))}}function comparePnml(t,e){const s=extractElementsForComparison(t),l=extractElementsForComparison(e),r=[];return s.places.length!==l.places.length?r.push(`Place count: ${s.places.length} vs ${l.places.length}`):s.places.forEach((t,e)=>{const s=l.places[e];t.id!==s.id&&r.push(`Place ${e} ID: "${t.id}" vs "${s.id}"`),t.name!==s.name&&r.push(`Place ${e} name: "${t.name}" vs "${s.name}"`),t.tokens!==s.tokens&&r.push(`Place ${e} tokens: ${t.tokens} vs ${s.tokens}`),t.x!==s.x&&r.push(`Place ${e} x: ${t.x} vs ${s.x}`),t.y!==s.y&&r.push(`Place ${e} y: ${t.y} vs ${s.y}`),t.width!==s.width&&r.push(`Place ${e} width: ${t.width} vs ${s.width}`),t.height!==s.height&&r.push(`Place ${e} height: ${t.height} vs ${s.height}`);const a=Math.abs(parseFloat(t.labelOffsetX)-parseFloat(s.labelOffsetX)),o=Math.abs(parseFloat(t.labelOffsetY)-parseFloat(s.labelOffsetY));"0"===t.labelOffsetX&&a>.1||t.labelOffsetX!==s.labelOffsetX&&r.push(`Place ${e} labelOffsetX: ${t.labelOffsetX} vs ${s.labelOffsetX}`),"0"===t.labelOffsetY&&o>.1||t.labelOffsetY!==s.labelOffsetY&&r.push(`Place ${e} labelOffsetY: ${t.labelOffsetY} vs ${s.labelOffsetY}`)}),s.transitions.length!==l.transitions.length?r.push(`Transition count: ${s.transitions.length} vs ${l.transitions.length}`):s.transitions.forEach((t,e)=>{const s=l.transitions[e];t.id!==s.id&&r.push(`Transition ${e} ID: "${t.id}" vs "${s.id}"`),t.name!==s.name&&r.push(`Transition ${e} name: "${t.name}" vs "${s.name}"`),t.isEmpty!==s.isEmpty&&r.push(`Transition ${e} type: empty=${t.isEmpty} vs ${s.isEmpty}`),t.x!==s.x&&r.push(`Transition ${e} x: ${t.x} vs ${s.x}`),t.y!==s.y&&r.push(`Transition ${e} y: ${t.y} vs ${s.y}`),t.width!==s.width&&r.push(`Transition ${e} width: ${t.width} vs ${s.width}`),t.height!==s.height&&r.push(`Transition ${e} height: ${t.height} vs ${s.height}`);const a=Math.abs(parseFloat(t.labelOffsetX)-parseFloat(s.labelOffsetX)),o=Math.abs(parseFloat(t.labelOffsetY)-parseFloat(s.labelOffsetY));"0"===t.labelOffsetX&&a>.1||t.labelOffsetX!==s.labelOffsetX&&r.push(`Transition ${e} labelOffsetX: ${t.labelOffsetX} vs ${s.labelOffsetX}`),"0"===t.labelOffsetY&&o>.1||t.labelOffsetY!==s.labelOffsetY&&r.push(`Transition ${e} labelOffsetY: ${t.labelOffsetY} vs ${s.labelOffsetY}`)}),s.arcs.length!==l.arcs.length?r.push(`Arc count: ${s.arcs.length} vs ${l.arcs.length}`):s.arcs.forEach((t,e)=>{const s=l.arcs[e];t.id!==s.id&&r.push(`Arc ${e} ID: "${t.id}" vs "${s.id}"`),t.source!==s.source&&r.push(`Arc ${e} source: "${t.source}" vs "${s.source}"`),t.target!==s.target&&r.push(`Arc ${e} target: "${t.target}" vs "${s.target}"`),t.inscription!==s.inscription&&r.push(`Arc ${e} inscription: "${t.inscription}" vs "${s.inscription}"`),t.labelOffsetX!==s.labelOffsetX&&r.push(`Arc ${e} labelOffsetX: ${t.labelOffsetX} vs ${s.labelOffsetX}`),"0"===t.labelOffsetY&&"-10"===s.labelOffsetY||t.labelOffsetY!==s.labelOffsetY&&r.push(`Arc ${e} labelOffsetY: ${t.labelOffsetY} vs ${s.labelOffsetY}`),t.waypointCount!==s.waypointCount?r.push(`Arc ${e} waypoint count: ${t.waypointCount} vs ${s.waypointCount}`):t.waypoints.forEach((t,l)=>{const a=s.waypoints[l];t.x!==a.x&&r.push(`Arc ${e} waypoint ${l} x: ${t.x} vs ${a.x}`),t.y!==a.y&&r.push(`Arc ${e} waypoint ${l} y: ${t.y} vs ${a.y}`)})}),{passed:0===r.length,errors:r}}async function testAllPnmlFiles(){const t=window.diagram;if(!t)return void console.error("❌ Diagram not found. Set window.diagram = diagram in your app");const e=["sequence.pnml","and-split.pnml","and-join.pnml","xor-split.pnml","xor-join.pnml"];console.log("Testing all PNML files with full property checking...\n"),console.log("Checking: IDs, positions, dimensions, tokens, labels, label offsets, waypoints, arc sources/targets\n");const s=t.get("pnmlImporter"),l=t.get("pnmlExporter");let r=0,a=0;for(const t of e)try{const e=await fetch(`test-pnmls/${t}`),o=await e.text();s.importPnml(o);const n=comparePnml(o,l.getPnmlString());n.passed?(console.log(`✅ ${t} - PASSED (all properties match)`),r++):(console.log(`❌ ${t} - FAILED`),n.errors.forEach(t=>console.log(`   ${t}`)),a++)}catch(e){console.log(`❌ ${t} - ERROR: ${e.message}`),console.error(e),a++}console.log(`\n Results: ${r} passed, ${a} failed`),0===a&&console.log("All tests passed!")}"undefined"!=typeof window&&(window.testAllPnmlFiles=testAllPnmlFiles,console.log("✅ PNML tests loaded! Run testAllPnmlFiles() to test import/export"));