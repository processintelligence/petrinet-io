if("undefined"!=typeof window&&window.testSimulationLogic)console.log("Simulation tests already loaded");else{const t=[{name:"Sequence",fired:"A",tokens:{p1:0,p2:1,p3:0},transitions_that_can_fire:["B"]},{name:"And Split",fired:"A",tokens:{p1:0,p2:1,p3:1},transitions_that_can_fire:["B","C"]},{name:"And Join",fired:"A",tokens:{p1:0,p2:1,p3:1,p4:0},transitions_that_can_fire:["B"]},{name:"Xor Split",fired:"A",tokens:{p1:0,p2:1},transitions_that_can_fire:["B","C"]},{name:"Xor Join",fired:"A",tokens:{p1:0,p2:1,p3:1},transitions_that_can_fire:["B","C"]}];async function testSimulationLogic(){const n=window.diagram;if(!n)return void console.error("❌ Diagram not found. Set window.diagram = diagram in your app");const i=n.get("simulationService"),e=n.get("pnmlImporter"),o=n.get("elementRegistry"),s=["sequence.pnml","and-split.pnml","and-join.pnml","xor-split.pnml","xor-join.pnml"];console.log("Testing simulation firing logic...\n");for(let n=0;n<s.length;n++){const a=s[n],r=t[n];try{const t=await fetch(`test-pnmls/${a}`),n=await t.text();e.importPnml(n),i.toggleSimulation();const s=o.getAll(),l=s.find(t=>("petri:transition"===t.type||"petri:empty_transition"===t.type)&&t.businessObject?.name===r.fired);if(!l){console.log(`❌ ${r.name}: Could not find transition "${r.fired}"`);continue}i.fireTransition(l);const c=s.filter(t=>"petri:place"===t.type),p={};c.forEach(t=>{p[t.id]=t.businessObject?.tokens||0});const m=s.filter(t=>("petri:transition"===t.type||"petri:empty_transition"===t.type)&&i.isTransitionEnabled(t)).map(t=>t.businessObject?.name||t.id);let d=[];Object.keys(r.tokens).forEach(t=>{const n=r.tokens[t],i=p[t];n!==i&&d.push(`Place ${t}: expected ${n} tokens, got ${i}`)});const g=r.transitions_that_can_fire.sort(),f=m.sort();JSON.stringify(g)!==JSON.stringify(f)&&d.push(`Enabled transitions: expected [${g.join(", ")}], got [${f.join(", ")}]`),0===d.length?console.log(`✅ ${r.name} - PASSED`):(console.log(`❌ ${r.name} - FAILED`),d.forEach(t=>console.log(`   ${t}`))),i.toggleSimulation()}catch(t){console.log(`❌ ${r.name}: ERROR - ${t.message}`)}}}"undefined"!=typeof window&&(window.testSimulationLogic=testSimulationLogic,console.log("✅ Simulation tests loaded! Run testSimulationLogic() to test firing logic"))}